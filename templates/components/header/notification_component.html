{% load thumbnail %}

{# todo: render notification_component use render_partial #}

{% if request.user.is_authenticated %}
    <div class="dropdown">
        <div class="indicator">
            <span class="indicator-item border border-1 border-base-100 badge left-[20px] top-[-25px] badge-success ">
                <span class="text-xs">
9
                </span>
            </span>
        </div>
        <label tabindex="0" class="btn btn-ghost text-gray-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                 stroke="currentColor"
                 stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                </path>
            </svg>
        </label>


        <div tabindex="0"
             class="dropdown-content h-[31.2rem] right-[-3rem] border-base-300 border-[1px] mt-2 overflow-visible card card-compact w-[28rem] max-sm:w-[20rem] p-2 right-0 bg-base-100 drop-shadow-2xl text-primary-content ">
            <div class="ml-52 -mb-[1px] inline-block ">
                <div class="h-3 w-3 -z-[100] border-base-300 absolute left-[17.4rem] sm:left-[25.4rem] -top-3 origin-bottom-left rotate-45 transform border-t-[1px] border-l-[1px] bg-base-100"></div>
            </div>
            <div class="overflow-x-auto">
                <div class="text-base-content p-3">
                    <div>
                        {% if request.user.profile.is_private %}
                            {% if request.user.profile.follow_request_by.all %}
                                <h1 class="text-xl capitalize">requests</h1>
                                {% include "activity/follow_request/follow_request_list.html" %}
                            {% else %}
                                <div class="flex mb-3 space-x-3 p-3 hover:bg-base-200 hover:rounded-md">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="capitalize">There are no follow requests</span>
                                </div>

                            {% endif %}
                        {% endif %}

                        {% if request.user.post_set %}
                            {% for post in request.user.post_set.all %}
                                {% if post.postlike_set %}
                                    {% for like in post.postlike_set.all %}
                                        <div class="flex flex-col gap-2 space-x-3 py-3 hover:bg-base-200 hover:rounded-md">
                                            <div class="flex ml-[10px] gap-2">
                                                <a href="{% url "show_post" slug=post.slug %}">
                                                    {% if post.image %}
                                                        <div class="avatar">
                                                            <div class="rounded w-12 h-12">
                                                                {% thumbnail post.image "48x48" crop="center" as img %}
                                                                    <img src="{{ img.url }}"
                                                                         alt="{{ post.user.username }}">
                                                                {% endthumbnail %}
                                                            </div>
                                                        </div>
                                                    {% elif post.audio %}
                                                    {% elif post.video %}
                                                    {% else %}
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6"
                                                             viewBox="0 0 20 20" fill="#F87272">
                                                            <path fill-rule="evenodd"
                                                                  d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                                                                  clip-rule="evenodd"></path>
                                                        </svg>
                                                    {% endif %}
                                                </a>
                                                <div class="w-full">
                                                    <div class="font-bold">
                                                        <p>
                                                            <a href="{% url "profile" username=like.user.username %}">
                                                                {{ like.user.username }}
                                                            </a>
                                                            Liked Your Post
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <p class="line-clamp-2">
                                                <a href="{% url "show_post" slug=post.slug %}">
                                                    {{ post.caption }}
                                                </a>
                                            </p>
                                        </div>
                                    {% endfor %}

                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}